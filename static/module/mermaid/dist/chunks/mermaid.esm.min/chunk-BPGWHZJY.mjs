import{a as E}from"./chunk-P33YXMZK.mjs";import{D as y,E as G,F as x,G as P,H as V,J as B,K as k,L as S,N as xr,P as O,T as A,U as Z,d as N,f as wr,h as Q,i as br,k as R,n as d,p as I,q as z,s as _,u as Er,v as yr,x as q,z as L}from"./chunk-TI3GW6ZA.mjs";import{O as F,T as Y,z as _r}from"./chunk-YLAFDWD2.mjs";import{a as s}from"./chunk-CPXVQKWD.mjs";function g(r,e,n,t){var o;do o=A(t);while(r.hasNode(o));return n.dummy=e,r.setNode(o,n),o}s(g,"addDummyNode");function kr(r){var e=new E().setGraph(r.graph());return d(r.nodes(),function(n){e.setNode(n,r.node(n))}),d(r.edges(),function(n){var t=e.edge(n.v,n.w)||{weight:0,minlen:1},o=r.edge(n);e.setEdge(n.v,n.w,{weight:t.weight+o.weight,minlen:Math.max(t.minlen,o.minlen)})}),e}s(kr,"simplify");function X(r){var e=new E({multigraph:r.isMultigraph()}).setGraph(r.graph());return d(r.nodes(),function(n){r.children(n).length||e.setNode(n,r.node(n))}),d(r.edges(),function(n){e.setEdge(n,r.edge(n))}),e}s(X,"asNonCompoundGraph");function $(r,e){var n=r.x,t=r.y,o=e.x-n,a=e.y-t,i=r.width/2,f=r.height/2;if(!o&&!a)throw new Error("Not possible to find intersection inside of the rectangle");var u,c;return Math.abs(a)*i>Math.abs(o)*f?(a<0&&(f=-f),u=f*o/a,c=f):(o<0&&(i=-i),u=i,c=i*a/o),{x:n+u,y:t+c}}s($,"intersectRect");function C(r){var e=_(k(er(r)+1),function(){return[]});return d(r.nodes(),function(n){var t=r.node(n),o=t.rank;y(o)||(e[o][t.order]=n)}),e}s(C,"buildLayerMatrix");function gr(r){var e=P(_(r.nodes(),function(n){return r.node(n).rank}));d(r.nodes(),function(n){var t=r.node(n);q(t,"rank")&&(t.rank-=e)})}s(gr,"normalizeRanks");function Nr(r){var e=P(_(r.nodes(),function(a){return r.node(a).rank})),n=[];d(r.nodes(),function(a){var i=r.node(a).rank-e;n[i]||(n[i]=[]),n[i].push(a)});var t=0,o=r.graph().nodeRankFactor;d(n,function(a,i){y(a)&&i%o!==0?--t:t&&d(a,function(f){r.node(f).rank+=t})})}s(Nr,"removeEmptyRanks");function rr(r,e,n,t){var o={width:0,height:0};return arguments.length>=4&&(o.rank=n,o.order=t),g(r,"border",o,e)}s(rr,"addBorderNode");function er(r){return x(_(r.nodes(),function(e){var n=r.node(e).rank;if(!y(n))return n}))}s(er,"maxRank");function Ir(r,e){var n={lhs:[],rhs:[]};return d(r,function(t){e(t)?n.lhs.push(t):n.rhs.push(t)}),n}s(Ir,"partition");function Or(r,e){var n=Q();try{return e()}finally{console.log(r+" time: "+(Q()-n)+"ms")}}s(Or,"time");function Lr(r,e){return e()}s(Lr,"notime");function Cr(r){function e(n){var t=r.children(n),o=r.node(n);if(t.length&&d(t,e),Object.prototype.hasOwnProperty.call(o,"minRank")){o.borderLeft=[],o.borderRight=[];for(var a=o.minRank,i=o.maxRank+1;a<i;++a)Pr(r,"borderLeft","_bl",n,o,a),Pr(r,"borderRight","_br",n,o,a)}}s(e,"dfs"),d(r.children(),e)}s(Cr,"addBorderSegments");function Pr(r,e,n,t,o,a){var i={width:0,height:0,rank:a,borderType:e},f=o[e][a-1],u=g(r,"border",i,n);o[e][a]=u,r.setParent(u,t),f&&r.setEdge(f,u,{weight:1})}s(Pr,"addBorderNode");function jr(r){var e=r.graph().rankdir.toLowerCase();(e==="lr"||e==="rl")&&Sr(r)}s(jr,"adjust");function Rr(r){var e=r.graph().rankdir.toLowerCase();(e==="bt"||e==="rl")&&me(r),(e==="lr"||e==="rl")&&(ve(r),Sr(r))}s(Rr,"undo");function Sr(r){d(r.nodes(),function(e){Tr(r.node(e))}),d(r.edges(),function(e){Tr(r.edge(e))})}s(Sr,"swapWidthHeight");function Tr(r){var e=r.width;r.width=r.height,r.height=e}s(Tr,"swapWidthHeightOne");function me(r){d(r.nodes(),function(e){nr(r.node(e))}),d(r.edges(),function(e){var n=r.edge(e);d(n.points,nr),Object.prototype.hasOwnProperty.call(n,"y")&&nr(n)})}s(me,"reverseY");function nr(r){r.y=-r.y}s(nr,"reverseYOne");function ve(r){d(r.nodes(),function(e){tr(r.node(e))}),d(r.edges(),function(e){var n=r.edge(e);d(n.points,tr),Object.prototype.hasOwnProperty.call(n,"x")&&tr(n)})}s(ve,"swapXY");function tr(r){var e=r.x;r.x=r.y,r.y=e}s(tr,"swapXYOne");var or=class or{constructor(){var e={};e._next=e._prev=e,this._sentinel=e}dequeue(){var e=this._sentinel,n=e._prev;if(n!==e)return Mr(n),n}enqueue(e){var n=this._sentinel;e._prev&&e._next&&Mr(e),e._next=n._next,n._next._prev=e,n._next=e,e._prev=n}toString(){for(var e=[],n=this._sentinel,t=n._prev;t!==n;)e.push(JSON.stringify(t,we)),t=t._prev;return"["+e.join(", ")+"]"}};s(or,"List");var H=or;function Mr(r){r._prev._next=r._next,r._next._prev=r._prev,delete r._next,delete r._prev}s(Mr,"unlink");function we(r,e){if(r!=="_next"&&r!=="_prev")return e}s(we,"filterOutLinks");var be=F(1);function Fr(r,e){if(r.nodeCount()<=1)return[];var n=ye(r,e||be),t=Ee(n.graph,n.buckets,n.zeroIdx);return N(_(t,function(o){return r.outEdges(o.v,o.w)}))}s(Fr,"greedyFAS");function Ee(r,e,n){for(var t=[],o=e[e.length-1],a=e[0],i;r.nodeCount();){for(;i=a.dequeue();)ar(r,e,n,i);for(;i=o.dequeue();)ar(r,e,n,i);if(r.nodeCount()){for(var f=e.length-2;f>0;--f)if(i=e[f].dequeue(),i){t=t.concat(ar(r,e,n,i,!0));break}}}return t}s(Ee,"doGreedyFAS");function ar(r,e,n,t,o){var a=o?[]:void 0;return d(r.inEdges(t.v),function(i){var f=r.edge(i),u=r.node(i.v);o&&a.push({v:i.v,w:i.w}),u.out-=f,ir(e,n,u)}),d(r.outEdges(t.v),function(i){var f=r.edge(i),u=i.w,c=r.node(u);c.in-=f,ir(e,n,c)}),r.removeNode(t.v),a}s(ar,"removeNode");function ye(r,e){var n=new E,t=0,o=0;d(r.nodes(),function(f){n.setNode(f,{v:f,in:0,out:0})}),d(r.edges(),function(f){var u=n.edge(f.v,f.w)||0,c=e(f),h=u+c;n.setEdge(f.v,f.w,h),o=Math.max(o,n.node(f.v).out+=c),t=Math.max(t,n.node(f.w).in+=c)});var a=k(o+t+3).map(function(){return new H}),i=t+1;return d(n.nodes(),function(f){ir(a,i,n.node(f))}),{graph:n,buckets:a,zeroIdx:i}}s(ye,"buildState");function ir(r,e,n){n.out?n.in?r[n.out-n.in+e].enqueue(n):r[r.length-1].enqueue(n):r[0].enqueue(n)}s(ir,"assignBucket");function Gr(r){var e=r.graph().acyclicer==="greedy"?Fr(r,n(r)):xe(r);d(e,function(t){var o=r.edge(t);r.removeEdge(t),o.forwardName=t.name,o.reversed=!0,r.setEdge(t.w,t.v,o,A("rev"))});function n(t){return function(o){return t.edge(o).weight}}s(n,"weightFn")}s(Gr,"run");function xe(r){var e=[],n={},t={};function o(a){Object.prototype.hasOwnProperty.call(t,a)||(t[a]=!0,n[a]=!0,d(r.outEdges(a),function(i){Object.prototype.hasOwnProperty.call(n,i.w)?e.push(i):o(i.w)}),delete n[a])}return s(o,"dfs"),d(r.nodes(),o),e}s(xe,"dfsFAS");function Vr(r){d(r.edges(),function(e){var n=r.edge(e);if(n.reversed){r.removeEdge(e);var t=n.forwardName;delete n.reversed,delete n.forwardName,r.setEdge(e.w,e.v,n,t)}})}s(Vr,"undo");function Ar(r){r.graph().dummyChains=[],d(r.edges(),function(e){ke(r,e)})}s(Ar,"run");function ke(r,e){var n=e.v,t=r.node(n).rank,o=e.w,a=r.node(o).rank,i=e.name,f=r.edge(e),u=f.labelRank;if(a!==t+1){r.removeEdge(e);var c=void 0,h,l;for(l=0,++t;t<a;++l,++t)f.points=[],c={width:0,height:0,edgeLabel:f,edgeObj:e,rank:t},h=g(r,"edge",c,"_d"),t===u&&(c.width=f.width,c.height=f.height,c.dummy="edge-label",c.labelpos=f.labelpos),r.setEdge(n,h,{weight:f.weight},i),l===0&&r.graph().dummyChains.push(h),n=h;r.setEdge(n,o,{weight:f.weight},i)}}s(ke,"normalizeEdge");function Dr(r){d(r.graph().dummyChains,function(e){var n=r.node(e),t=n.edgeLabel,o;for(r.setEdge(n.edgeObj,t);n.dummy;)o=r.successors(e)[0],r.removeNode(e),t.points.push({x:n.x,y:n.y}),n.dummy==="edge-label"&&(t.x=n.x,t.y=n.y,t.width=n.width,t.height=n.height),e=o,n=r.node(e)})}s(Dr,"undo");function U(r){var e={};function n(t){var o=r.node(t);if(Object.prototype.hasOwnProperty.call(e,t))return o.rank;e[t]=!0;var a=P(_(r.outEdges(t),function(i){return n(i.w)-r.edge(i).minlen}));return(a===Number.POSITIVE_INFINITY||a===void 0||a===null)&&(a=0),o.rank=a}s(n,"dfs"),d(r.sources(),n)}s(U,"longestPath");function M(r,e){return r.node(e.w).rank-r.node(e.v).rank-r.edge(e).minlen}s(M,"slack");function J(r){var e=new E({directed:!1}),n=r.nodes()[0],t=r.nodeCount();e.setNode(n,{});for(var o,a;ge(e,r)<t;)o=Ne(e,r),a=e.hasNode(o.v)?M(r,o):-M(r,o),Ie(e,r,a);return e}s(J,"feasibleTree");function ge(r,e){function n(t){d(e.nodeEdges(t),function(o){var a=o.v,i=t===a?o.w:a;!r.hasNode(i)&&!M(e,o)&&(r.setNode(i,{}),r.setEdge(t,i,{}),n(i))})}return s(n,"dfs"),d(r.nodes(),n),r.nodeCount()}s(ge,"tightTree");function Ne(r,e){return V(e.edges(),function(n){if(r.hasNode(n.v)!==r.hasNode(n.w))return M(e,n)})}s(Ne,"findMinSlackEdge");function Ie(r,e,n){d(r.nodes(),function(t){e.node(t).rank+=n})}s(Ie,"shiftRanks");var ot=F(1);var mt=F(1);sr.CycleException=W;function sr(r){var e={},n={},t=[];function o(a){if(Object.prototype.hasOwnProperty.call(n,a))throw new W;Object.prototype.hasOwnProperty.call(e,a)||(n[a]=!0,e[a]=!0,d(r.predecessors(a),o),delete n[a],t.push(a))}if(s(o,"visit"),d(r.sinks(),o),xr(e)!==r.nodeCount())throw new W;return t}s(sr,"topsort");function W(){}s(W,"CycleException");W.prototype=new Error;function K(r,e,n){_r(e)||(e=[e]);var t=(r.isDirected()?r.successors:r.neighbors).bind(r),o=[],a={};return d(e,function(i){if(!r.hasNode(i))throw new Error("Graph does not have node: "+i);zr(r,i,n==="post",a,t,o)}),o}s(K,"dfs");function zr(r,e,n,t,o,a){Object.prototype.hasOwnProperty.call(t,e)||(t[e]=!0,n||a.push(e),d(o(e),function(i){zr(r,i,n,t,o,a)}),n&&a.push(e))}s(zr,"doDfs");function fr(r,e){return K(r,e,"post")}s(fr,"postorder");function dr(r,e){return K(r,e,"pre")}s(dr,"preorder");j.initLowLimValues=cr;j.initCutValues=ur;j.calcCutValue=Wr;j.leaveEdge=Xr;j.enterEdge=Hr;j.exchangeEdges=Jr;function j(r){r=kr(r),U(r);var e=J(r);cr(e),ur(e,r);for(var n,t;n=Xr(e);)t=Hr(e,r,n),Jr(e,r,n,t)}s(j,"networkSimplex");function ur(r,e){var n=fr(r,r.nodes());n=n.slice(0,n.length-1),d(n,function(t){Te(r,e,t)})}s(ur,"initCutValues");function Te(r,e,n){var t=r.node(n),o=t.parent;r.edge(n,o).cutvalue=Wr(r,e,n)}s(Te,"assignCutValue");function Wr(r,e,n){var t=r.node(n),o=t.parent,a=!0,i=e.edge(n,o),f=0;return i||(a=!1,i=e.edge(o,n)),f=i.weight,d(e.nodeEdges(n),function(u){var c=u.v===n,h=c?u.w:u.v;if(h!==o){var l=c===a,p=e.edge(u).weight;if(f+=l?p:-p,Re(r,n,h)){var m=r.edge(n,h).cutvalue;f+=l?-m:m}}}),f}s(Wr,"calcCutValue");function cr(r,e){arguments.length<2&&(e=r.nodes()[0]),qr(r,{},1,e)}s(cr,"initLowLimValues");function qr(r,e,n,t,o){var a=n,i=r.node(t);return e[t]=!0,d(r.neighbors(t),function(f){Object.prototype.hasOwnProperty.call(e,f)||(n=qr(r,e,n,f,t))}),i.low=a,i.lim=n++,o?i.parent=o:delete i.parent,n}s(qr,"dfsAssignLowLim");function Xr(r){return z(r.edges(),function(e){return r.edge(e).cutvalue<0})}s(Xr,"leaveEdge");function Hr(r,e,n){var t=n.v,o=n.w;e.hasEdge(t,o)||(t=n.w,o=n.v);var a=r.node(t),i=r.node(o),f=a,u=!1;a.lim>i.lim&&(f=i,u=!0);var c=I(e.edges(),function(h){return u===Ur(r,r.node(h.v),f)&&u!==Ur(r,r.node(h.w),f)});return V(c,function(h){return M(e,h)})}s(Hr,"enterEdge");function Jr(r,e,n,t){var o=n.v,a=n.w;r.removeEdge(o,a),r.setEdge(t.v,t.w,{}),cr(r),ur(r,e),je(r,e)}s(Jr,"exchangeEdges");function je(r,e){var n=z(r.nodes(),function(o){return!e.node(o).parent}),t=dr(r,n);t=t.slice(1),d(t,function(o){var a=r.node(o).parent,i=e.edge(o,a),f=!1;i||(i=e.edge(a,o),f=!0),e.node(o).rank=e.node(a).rank+(f?i.minlen:-i.minlen)})}s(je,"updateRanks");function Re(r,e,n){return r.hasEdge(e,n)}s(Re,"isTreeEdge");function Ur(r,e,n){return n.low<=e.lim&&e.lim<=n.lim}s(Ur,"isDescendant");function hr(r){switch(r.graph().ranker){case"network-simplex":Kr(r);break;case"tight-tree":Me(r);break;case"longest-path":Se(r);break;default:Kr(r)}}s(hr,"rank");var Se=U;function Me(r){U(r),J(r)}s(Me,"tightTreeRanker");function Kr(r){j(r)}s(Kr,"networkSimplexRanker");function Qr(r){var e=g(r,"root",{},"_root"),n=Fe(r),t=x(L(n))-1,o=2*t+1;r.graph().nestingRoot=e,d(r.edges(),function(i){r.edge(i).minlen*=o});var a=Ge(r)+1;d(r.children(),function(i){Zr(r,e,o,a,t,n,i)}),r.graph().nodeRankFactor=o}s(Qr,"run");function Zr(r,e,n,t,o,a,i){var f=r.children(i);if(!f.length){i!==e&&r.setEdge(e,i,{weight:0,minlen:n});return}var u=rr(r,"_bt"),c=rr(r,"_bb"),h=r.node(i);r.setParent(u,i),h.borderTop=u,r.setParent(c,i),h.borderBottom=c,d(f,function(l){Zr(r,e,n,t,o,a,l);var p=r.node(l),m=p.borderTop?p.borderTop:l,v=p.borderBottom?p.borderBottom:l,b=p.borderTop?t:2*t,D=m!==v?1:o-a[i]+1;r.setEdge(u,m,{weight:b,minlen:D,nestingEdge:!0}),r.setEdge(v,c,{weight:b,minlen:D,nestingEdge:!0})}),r.parent(i)||r.setEdge(e,u,{weight:0,minlen:o+a[i]})}s(Zr,"dfs");function Fe(r){var e={};function n(t,o){var a=r.children(t);a&&a.length&&d(a,function(i){n(i,o+1)}),e[t]=o}return s(n,"dfs"),d(r.children(),function(t){n(t,1)}),e}s(Fe,"treeDepths");function Ge(r){return S(r.edges(),function(e,n){return e+r.edge(n).weight},0)}s(Ge,"sumWeights");function $r(r){var e=r.graph();r.removeNode(e.nestingRoot),delete e.nestingRoot,d(r.edges(),function(n){var t=r.edge(n);t.nestingEdge&&r.removeEdge(n)})}s($r,"cleanup");function re(r,e,n){var t={},o;d(n,function(a){for(var i=r.parent(a),f,u;i;){if(f=r.parent(i),f?(u=t[f],t[f]=i):(u=o,o=i),u&&u!==i){e.setEdge(u,i);return}i=f}})}s(re,"addSubgraphConstraints");function ee(r,e,n){var t=Be(r),o=new E({compound:!0}).setGraph({root:t}).setDefaultNodeLabel(function(a){return r.node(a)});return d(r.nodes(),function(a){var i=r.node(a),f=r.parent(a);(i.rank===e||i.minRank<=e&&e<=i.maxRank)&&(o.setNode(a),o.setParent(a,f||t),d(r[n](a),function(u){var c=u.v===a?u.w:u.v,h=o.edge(c,a),l=y(h)?0:h.weight;o.setEdge(c,a,{weight:r.edge(u).weight+l})}),Object.prototype.hasOwnProperty.call(i,"minRank")&&o.setNode(a,{borderLeft:i.borderLeft[e],borderRight:i.borderRight[e]}))}),o}s(ee,"buildLayerGraph");function Be(r){for(var e;r.hasNode(e=A("_root")););return e}s(Be,"createRootNode");function ne(r,e){for(var n=0,t=1;t<e.length;++t)n+=Ae(r,e[t-1],e[t]);return n}s(ne,"crossCount");function Ae(r,e,n){for(var t=Z(n,_(n,function(c,h){return h})),o=N(_(e,function(c){return O(_(r.outEdges(c),function(h){return{pos:t[h.w],weight:r.edge(h).weight}}),"pos")})),a=1;a<n.length;)a<<=1;var i=2*a-1;a-=1;var f=_(new Array(i),function(){return 0}),u=0;return d(o.forEach(function(c){var h=c.pos+a;f[h]+=c.weight;for(var l=0;h>0;)h%2&&(l+=f[h+1]),h=h-1>>1,f[h]+=c.weight;u+=c.weight*l})),u}s(Ae,"twoLayerCrossCount");function te(r){var e={},n=I(r.nodes(),function(f){return!r.children(f).length}),t=x(_(n,function(f){return r.node(f).rank})),o=_(k(t+1),function(){return[]});function a(f){if(!q(e,f)){e[f]=!0;var u=r.node(f);o[u.rank].push(f),d(r.successors(f),a)}}s(a,"dfs");var i=O(n,function(f){return r.node(f).rank});return d(i,a),o}s(te,"initOrder");function oe(r,e){return _(e,function(n){var t=r.inEdges(n);if(t.length){var o=S(t,function(a,i){var f=r.edge(i),u=r.node(i.v);return{sum:a.sum+f.weight*u.order,weight:a.weight+f.weight}},{sum:0,weight:0});return{v:n,barycenter:o.sum/o.weight,weight:o.weight}}else return{v:n}})}s(oe,"barycenter");function ae(r,e){var n={};d(r,function(o,a){var i=n[o.v]={indegree:0,in:[],out:[],vs:[o.v],i:a};y(o.barycenter)||(i.barycenter=o.barycenter,i.weight=o.weight)}),d(e.edges(),function(o){var a=n[o.v],i=n[o.w];!y(a)&&!y(i)&&(i.indegree++,a.out.push(n[o.w]))});var t=I(n,function(o){return!o.indegree});return De(t)}s(ae,"resolveConflicts");function De(r){var e=[];function n(a){return function(i){i.merged||(y(i.barycenter)||y(a.barycenter)||i.barycenter>=a.barycenter)&&Ye(a,i)}}s(n,"handleIn");function t(a){return function(i){i.in.push(a),--i.indegree===0&&r.push(i)}}for(s(t,"handleOut");r.length;){var o=r.pop();e.push(o),d(o.in.reverse(),n(o)),d(o.out,t(o))}return _(I(e,function(a){return!a.merged}),function(a){return B(a,["vs","i","barycenter","weight"])})}s(De,"doResolveConflicts");function Ye(r,e){var n=0,t=0;r.weight&&(n+=r.barycenter*r.weight,t+=r.weight),e.weight&&(n+=e.barycenter*e.weight,t+=e.weight),r.vs=e.vs.concat(r.vs),r.barycenter=n/t,r.weight=t,r.i=Math.min(e.i,r.i),e.merged=!0}s(Ye,"mergeEntries");function se(r,e){var n=Ir(r,function(h){return Object.prototype.hasOwnProperty.call(h,"barycenter")}),t=n.lhs,o=O(n.rhs,function(h){return-h.i}),a=[],i=0,f=0,u=0;t.sort(ze(!!e)),u=ie(a,o,u),d(t,function(h){u+=h.vs.length,a.push(h.vs),i+=h.barycenter*h.weight,f+=h.weight,u=ie(a,o,u)});var c={vs:N(a)};return f&&(c.barycenter=i/f,c.weight=f),c}s(se,"sort");function ie(r,e,n){for(var t;e.length&&(t=R(e)).i<=n;)e.pop(),r.push(t.vs),n++;return n}s(ie,"consumeUnsortable");function ze(r){return function(e,n){return e.barycenter<n.barycenter?-1:e.barycenter>n.barycenter?1:r?n.i-e.i:e.i-n.i}}s(ze,"compareWithBias");function lr(r,e,n,t){var o=r.children(e),a=r.node(e),i=a?a.borderLeft:void 0,f=a?a.borderRight:void 0,u={};i&&(o=I(o,function(v){return v!==i&&v!==f}));var c=oe(r,o);d(c,function(v){if(r.children(v.v).length){var b=lr(r,v.v,n,t);u[v.v]=b,Object.prototype.hasOwnProperty.call(b,"barycenter")&&We(v,b)}});var h=ae(c,n);Ue(h,u);var l=se(h,t);if(i&&(l.vs=N([i,l.vs,f]),r.predecessors(i).length)){var p=r.node(r.predecessors(i)[0]),m=r.node(r.predecessors(f)[0]);Object.prototype.hasOwnProperty.call(l,"barycenter")||(l.barycenter=0,l.weight=0),l.barycenter=(l.barycenter*l.weight+p.order+m.order)/(l.weight+2),l.weight+=2}return l}s(lr,"sortSubgraph");function Ue(r,e){d(r,function(n){n.vs=N(n.vs.map(function(t){return e[t]?e[t].vs:t}))})}s(Ue,"expandSubgraphs");function We(r,e){y(r.barycenter)?(r.barycenter=e.barycenter,r.weight=e.weight):(r.barycenter=(r.barycenter*r.weight+e.barycenter*e.weight)/(r.weight+e.weight),r.weight+=e.weight)}s(We,"mergeBarycenters");function ue(r){var e=er(r),n=fe(r,k(1,e+1),"inEdges"),t=fe(r,k(e-1,-1,-1),"outEdges"),o=te(r);de(r,o);for(var a=Number.POSITIVE_INFINITY,i,f=0,u=0;u<4;++f,++u){qe(f%2?n:t,f%4>=2),o=C(r);var c=ne(r,o);c<a&&(u=0,i=wr(o),a=c)}de(r,i)}s(ue,"order");function fe(r,e,n){return _(e,function(t){return ee(r,t,n)})}s(fe,"buildLayerGraphs");function qe(r,e){var n=new E;d(r,function(t){var o=t.graph().root,a=lr(t,o,n,e);d(a.vs,function(i,f){t.node(i).order=f}),re(t,n,a.vs)})}s(qe,"sweepLayerGraphs");function de(r,e){d(e,function(n){d(n,function(t,o){r.node(t).order=o})})}s(de,"assignOrder");function ce(r){var e=He(r);d(r.graph().dummyChains,function(n){for(var t=r.node(n),o=t.edgeObj,a=Xe(r,e,o.v,o.w),i=a.path,f=a.lca,u=0,c=i[u],h=!0;n!==o.w;){if(t=r.node(n),h){for(;(c=i[u])!==f&&r.node(c).maxRank<t.rank;)u++;c===f&&(h=!1)}if(!h){for(;u<i.length-1&&r.node(c=i[u+1]).minRank<=t.rank;)u++;c=i[u]}r.setParent(n,c),n=r.successors(n)[0]}})}s(ce,"parentDummyChains");function Xe(r,e,n,t){var o=[],a=[],i=Math.min(e[n].low,e[t].low),f=Math.max(e[n].lim,e[t].lim),u,c;u=n;do u=r.parent(u),o.push(u);while(u&&(e[u].low>i||f>e[u].lim));for(c=u,u=t;(u=r.parent(u))!==c;)a.push(u);return{path:o.concat(a.reverse()),lca:c}}s(Xe,"findPath");function He(r){var e={},n=0;function t(o){var a=n;d(r.children(o),t),e[o]={low:a,lim:n++}}return s(t,"dfs"),d(r.children(),t),e}s(He,"postorder");function Je(r,e){var n={};function t(o,a){var i=0,f=0,u=o.length,c=R(a);return d(a,function(h,l){var p=Qe(r,h),m=p?r.node(p).order:u;(p||h===c)&&(d(a.slice(f,l+1),function(v){d(r.predecessors(v),function(b){var D=r.node(b),vr=D.order;(vr<i||m<vr)&&!(D.dummy&&r.node(v).dummy)&&he(n,b,v)})}),f=l+1,i=m)}),a}return s(t,"visitLayer"),S(e,t),n}s(Je,"findType1Conflicts");function Ke(r,e){var n={};function t(a,i,f,u,c){var h;d(k(i,f),function(l){h=a[l],r.node(h).dummy&&d(r.predecessors(h),function(p){var m=r.node(p);m.dummy&&(m.order<u||m.order>c)&&he(n,p,h)})})}s(t,"scan");function o(a,i){var f=-1,u,c=0;return d(i,function(h,l){if(r.node(h).dummy==="border"){var p=r.predecessors(h);p.length&&(u=r.node(p[0]).order,t(i,c,l,f,u),c=l,f=u)}t(i,c,i.length,u,a.length)}),i}return s(o,"visitLayer"),S(e,o),n}s(Ke,"findType2Conflicts");function Qe(r,e){if(r.node(e).dummy)return z(r.predecessors(e),function(n){return r.node(n).dummy})}s(Qe,"findOtherInnerSegmentNode");function he(r,e,n){if(e>n){var t=e;e=n,n=t}var o=r[e];o||(r[e]=o={}),o[n]=!0}s(he,"addConflict");function Ze(r,e,n){if(e>n){var t=e;e=n,n=t}return!!r[e]&&Object.prototype.hasOwnProperty.call(r[e],n)}s(Ze,"hasConflict");function $e(r,e,n,t){var o={},a={},i={};return d(e,function(f){d(f,function(u,c){o[u]=u,a[u]=u,i[u]=c})}),d(e,function(f){var u=-1;d(f,function(c){var h=t(c);if(h.length){h=O(h,function(b){return i[b]});for(var l=(h.length-1)/2,p=Math.floor(l),m=Math.ceil(l);p<=m;++p){var v=h[p];a[c]===c&&u<i[v]&&!Ze(n,c,v)&&(a[v]=c,a[c]=o[c]=o[v],u=i[v])}}})}),{root:o,align:a}}s($e,"verticalAlignment");function rn(r,e,n,t,o){var a={},i=en(r,e,n,o),f=o?"borderLeft":"borderRight";function u(l,p){for(var m=i.nodes(),v=m.pop(),b={};v;)b[v]?l(v):(b[v]=!0,m.push(v),m=m.concat(p(v))),v=m.pop()}s(u,"iterate");function c(l){a[l]=i.inEdges(l).reduce(function(p,m){return Math.max(p,a[m.v]+i.edge(m))},0)}s(c,"pass1");function h(l){var p=i.outEdges(l).reduce(function(v,b){return Math.min(v,a[b.w]-i.edge(b))},Number.POSITIVE_INFINITY),m=r.node(l);p!==Number.POSITIVE_INFINITY&&m.borderType!==f&&(a[l]=Math.max(a[l],p))}return s(h,"pass2"),u(c,i.predecessors.bind(i)),u(h,i.successors.bind(i)),d(t,function(l){a[l]=a[n[l]]}),a}s(rn,"horizontalCompaction");function en(r,e,n,t){var o=new E,a=r.graph(),i=an(a.nodesep,a.edgesep,t);return d(e,function(f){var u;d(f,function(c){var h=n[c];if(o.setNode(h),u){var l=n[u],p=o.edge(l,h);o.setEdge(l,h,Math.max(i(r,c,u),p||0))}u=c})}),o}s(en,"buildBlockGraph");function nn(r,e){return V(L(e),function(n){var t=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY;return Er(n,function(a,i){var f=sn(r,i)/2;t=Math.max(a+f,t),o=Math.min(a-f,o)}),t-o})}s(nn,"findSmallestWidthAlignment");function tn(r,e){var n=L(e),t=P(n),o=x(n);d(["u","d"],function(a){d(["l","r"],function(i){var f=a+i,u=r[f],c;if(u!==e){var h=L(u);c=i==="l"?t-P(h):o-x(h),c&&(r[f]=G(u,function(l){return l+c}))}})})}s(tn,"alignCoordinates");function on(r,e){return G(r.ul,function(n,t){if(e)return r[e.toLowerCase()][t];var o=O(_(r,t));return(o[1]+o[2])/2})}s(on,"balance");function le(r){var e=C(r),n=Y(Je(r,e),Ke(r,e)),t={},o;d(["u","d"],function(i){o=i==="u"?e:L(e).reverse(),d(["l","r"],function(f){f==="r"&&(o=_(o,function(l){return L(l).reverse()}));var u=(i==="u"?r.predecessors:r.successors).bind(r),c=$e(r,o,n,u),h=rn(r,o,c.root,c.align,f==="r");f==="r"&&(h=G(h,function(l){return-l})),t[i+f]=h})});var a=nn(r,t);return tn(t,a),on(t,r.graph().align)}s(le,"positionX");function an(r,e,n){return function(t,o,a){var i=t.node(o),f=t.node(a),u=0,c;if(u+=i.width/2,Object.prototype.hasOwnProperty.call(i,"labelpos"))switch(i.labelpos.toLowerCase()){case"l":c=-i.width/2;break;case"r":c=i.width/2;break}if(c&&(u+=n?c:-c),c=0,u+=(i.dummy?e:r)/2,u+=(f.dummy?e:r)/2,u+=f.width/2,Object.prototype.hasOwnProperty.call(f,"labelpos"))switch(f.labelpos.toLowerCase()){case"l":c=f.width/2;break;case"r":c=-f.width/2;break}return c&&(u+=n?c:-c),c=0,u}}s(an,"sep");function sn(r,e){return r.node(e).width}s(sn,"width");function pe(r){r=X(r),fn(r),yr(le(r),function(e,n){r.node(n).x=e})}s(pe,"position");function fn(r){var e=C(r),n=r.graph().ranksep,t=0;d(e,function(o){var a=x(_(o,function(i){return r.node(i).height}));d(o,function(i){r.node(i).y=t+a/2}),t+=a+n})}s(fn,"positionY");function dn(r,e){var n=e&&e.debugTiming?Or:Lr;n("layout",()=>{var t=n("  buildLayoutGraph",()=>En(r));n("  runLayout",()=>un(t,n)),n("  updateInputGraph",()=>cn(r,t))})}s(dn,"layout");function un(r,e){e("    makeSpaceForEdgeLabels",()=>yn(r)),e("    removeSelfEdges",()=>Cn(r)),e("    acyclic",()=>Gr(r)),e("    nestingGraph.run",()=>Qr(r)),e("    rank",()=>hr(X(r))),e("    injectEdgeLabelProxies",()=>xn(r)),e("    removeEmptyRanks",()=>Nr(r)),e("    nestingGraph.cleanup",()=>$r(r)),e("    normalizeRanks",()=>gr(r)),e("    assignRankMinMax",()=>kn(r)),e("    removeEdgeLabelProxies",()=>gn(r)),e("    normalize.run",()=>Ar(r)),e("    parentDummyChains",()=>ce(r)),e("    addBorderSegments",()=>Cr(r)),e("    order",()=>ue(r)),e("    insertSelfEdges",()=>Tn(r)),e("    adjustCoordinateSystem",()=>jr(r)),e("    position",()=>pe(r)),e("    positionSelfEdges",()=>jn(r)),e("    removeBorderNodes",()=>Pn(r)),e("    normalize.undo",()=>Dr(r)),e("    fixupEdgeLabelCoords",()=>On(r)),e("    undoCoordinateSystem",()=>Rr(r)),e("    translateGraph",()=>Nn(r)),e("    assignNodeIntersects",()=>In(r)),e("    reversePoints",()=>Ln(r)),e("    acyclic.undo",()=>Vr(r))}s(un,"runLayout");function cn(r,e){d(r.nodes(),function(n){var t=r.node(n),o=e.node(n);t&&(t.x=o.x,t.y=o.y,e.children(n).length&&(t.width=o.width,t.height=o.height))}),d(r.edges(),function(n){var t=r.edge(n),o=e.edge(n);t.points=o.points,Object.prototype.hasOwnProperty.call(o,"x")&&(t.x=o.x,t.y=o.y)}),r.graph().width=e.graph().width,r.graph().height=e.graph().height}s(cn,"updateInputGraph");var hn=["nodesep","edgesep","ranksep","marginx","marginy"],ln={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},pn=["acyclicer","ranker","rankdir","align"],mn=["width","height"],vn={width:0,height:0},_n=["minlen","weight","width","height","labeloffset"],wn={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},bn=["labelpos"];function En(r){var e=new E({multigraph:!0,compound:!0}),n=mr(r.graph());return e.setGraph(Y({},ln,pr(n,hn),B(n,pn))),d(r.nodes(),function(t){var o=mr(r.node(t));e.setNode(t,br(pr(o,mn),vn)),e.setParent(t,r.parent(t))}),d(r.edges(),function(t){var o=mr(r.edge(t));e.setEdge(t,Y({},wn,pr(o,_n),B(o,bn)))}),e}s(En,"buildLayoutGraph");function yn(r){var e=r.graph();e.ranksep/=2,d(r.edges(),function(n){var t=r.edge(n);t.minlen*=2,t.labelpos.toLowerCase()!=="c"&&(e.rankdir==="TB"||e.rankdir==="BT"?t.width+=t.labeloffset:t.height+=t.labeloffset)})}s(yn,"makeSpaceForEdgeLabels");function xn(r){d(r.edges(),function(e){var n=r.edge(e);if(n.width&&n.height){var t=r.node(e.v),o=r.node(e.w),a={rank:(o.rank-t.rank)/2+t.rank,e};g(r,"edge-proxy",a,"_ep")}})}s(xn,"injectEdgeLabelProxies");function kn(r){var e=0;d(r.nodes(),function(n){var t=r.node(n);t.borderTop&&(t.minRank=r.node(t.borderTop).rank,t.maxRank=r.node(t.borderBottom).rank,e=x(e,t.maxRank))}),r.graph().maxRank=e}s(kn,"assignRankMinMax");function gn(r){d(r.nodes(),function(e){var n=r.node(e);n.dummy==="edge-proxy"&&(r.edge(n.e).labelRank=n.rank,r.removeNode(e))})}s(gn,"removeEdgeLabelProxies");function Nn(r){var e=Number.POSITIVE_INFINITY,n=0,t=Number.POSITIVE_INFINITY,o=0,a=r.graph(),i=a.marginx||0,f=a.marginy||0;function u(c){var h=c.x,l=c.y,p=c.width,m=c.height;e=Math.min(e,h-p/2),n=Math.max(n,h+p/2),t=Math.min(t,l-m/2),o=Math.max(o,l+m/2)}s(u,"getExtremes"),d(r.nodes(),function(c){u(r.node(c))}),d(r.edges(),function(c){var h=r.edge(c);Object.prototype.hasOwnProperty.call(h,"x")&&u(h)}),e-=i,t-=f,d(r.nodes(),function(c){var h=r.node(c);h.x-=e,h.y-=t}),d(r.edges(),function(c){var h=r.edge(c);d(h.points,function(l){l.x-=e,l.y-=t}),Object.prototype.hasOwnProperty.call(h,"x")&&(h.x-=e),Object.prototype.hasOwnProperty.call(h,"y")&&(h.y-=t)}),a.width=n-e+i,a.height=o-t+f}s(Nn,"translateGraph");function In(r){d(r.edges(),function(e){var n=r.edge(e),t=r.node(e.v),o=r.node(e.w),a,i;n.points?(a=n.points[0],i=n.points[n.points.length-1]):(n.points=[],a=o,i=t),n.points.unshift($(t,a)),n.points.push($(o,i))})}s(In,"assignNodeIntersects");function On(r){d(r.edges(),function(e){var n=r.edge(e);if(Object.prototype.hasOwnProperty.call(n,"x"))switch((n.labelpos==="l"||n.labelpos==="r")&&(n.width-=n.labeloffset),n.labelpos){case"l":n.x-=n.width/2+n.labeloffset;break;case"r":n.x+=n.width/2+n.labeloffset;break}})}s(On,"fixupEdgeLabelCoords");function Ln(r){d(r.edges(),function(e){var n=r.edge(e);n.reversed&&n.points.reverse()})}s(Ln,"reversePointsForReversedEdges");function Pn(r){d(r.nodes(),function(e){if(r.children(e).length){var n=r.node(e),t=r.node(n.borderTop),o=r.node(n.borderBottom),a=r.node(R(n.borderLeft)),i=r.node(R(n.borderRight));n.width=Math.abs(i.x-a.x),n.height=Math.abs(o.y-t.y),n.x=a.x+n.width/2,n.y=t.y+n.height/2}}),d(r.nodes(),function(e){r.node(e).dummy==="border"&&r.removeNode(e)})}s(Pn,"removeBorderNodes");function Cn(r){d(r.edges(),function(e){if(e.v===e.w){var n=r.node(e.v);n.selfEdges||(n.selfEdges=[]),n.selfEdges.push({e,label:r.edge(e)}),r.removeEdge(e)}})}s(Cn,"removeSelfEdges");function Tn(r){var e=C(r);d(e,function(n){var t=0;d(n,function(o,a){var i=r.node(o);i.order=a+t,d(i.selfEdges,function(f){g(r,"selfedge",{width:f.label.width,height:f.label.height,rank:i.rank,order:a+ ++t,e:f.e,label:f.label},"_se")}),delete i.selfEdges})})}s(Tn,"insertSelfEdges");function jn(r){d(r.nodes(),function(e){var n=r.node(e);if(n.dummy==="selfedge"){var t=r.node(n.e.v),o=t.x+t.width/2,a=t.y,i=n.x-o,f=t.height/2;r.setEdge(n.e,n.label),r.removeNode(e),n.label.points=[{x:o+2*i/3,y:a-f},{x:o+5*i/6,y:a-f},{x:o+i,y:a},{x:o+5*i/6,y:a+f},{x:o+2*i/3,y:a+f}],n.label.x=n.x,n.label.y=n.y}})}s(jn,"positionSelfEdges");function pr(r,e){return G(B(r,e),Number)}s(pr,"selectNumberAttrs");function mr(r){var e={};return d(r,function(n,t){e[t.toLowerCase()]=n}),e}s(mr,"canonicalize");export{dn as a};
